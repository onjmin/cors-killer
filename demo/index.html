<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@onjmin/cors-killer Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <script type="module">
        import { corsKiller } from 'https://cdn.jsdelivr.net/npm/@onjmin/cors-killer/dist/index.min.mjs';

        window.corsKiller = corsKiller;

        document.addEventListener('DOMContentLoaded', () => {
            const definedUrls = [
                {
                    url: 'https://upload.wikimedia.org/wikipedia/commons/4/4e/Flag_of_Japan.png',
                    expected: 'ç´ é€šã‚Š (CORS OK)',
                    isProxied: false
                },
                {
                    url: 'https://i.imgur.com/k9b6c1s.png',
                    expected: 'ç´ é€šã‚Š (Imgurã¯CORS OK)',
                    isProxied: false
                },
                {
                    url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0BMVEUAAAD///+ZmTOhUb4AAAANlklEQVQiY2CgCAABpA//M/448d8AAAD//w==',
                    expected: 'ç´ é€šã‚Š (Base64)',
                    isProxied: false
                },
                {
                    url: 'https://example.com/image.jpg',
                    expected: 'ãƒ—ãƒ­ã‚­ã‚·å¤‰æ› (CORS NGã®å¯èƒ½æ€§)',
                    isProxied: true
                },
                {
                    url: 'http://insecure-site.com/test.gif',
                    expected: 'ãƒ—ãƒ­ã‚­ã‚·å¤‰æ› (HTTPSã§ãªã„)',
                    isProxied: true
                },
            ];

            const tableBody = document.getElementById('url-test-tbody');
            const manualUrlInput = document.getElementById('manual-url-input');
            const manualProcessButton = document.getElementById('manual-process-btn');
            const manualResultCode = document.getElementById('manual-result-code');
            const manualResultStatus = document.getElementById('manual-result-status');
            const manualImageTestArea = document.getElementById('manual-image-test-area');

            // --- å®šç¾©æ¸ˆã¿URLã®ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ ---
            definedUrls.forEach(item => {
                const safeUrl = window.corsKiller(item.url);
                const isActuallyProxied = safeUrl.includes('proxy') || safeUrl.includes('allorigins') || safeUrl.includes('codetabs');

                let statusClass = 'text-green-600 font-bold';
                let statusText = 'OK';

                if (item.isProxied !== isActuallyProxied) {
                    statusClass = 'text-red-600 font-bold';
                    statusText = 'æ„å›³ã¨ç•°ãªã‚‹çµæœ';
                }

                const row = tableBody.insertRow();
                row.className = 'border-b hover:bg-gray-50';

                // å…ƒURL
                row.insertCell().innerHTML = `<code class="text-sm text-gray-800 break-all">${item.url}</code>`;
                // å¤‰æ›å¾ŒURL
                row.insertCell().innerHTML = `<code class="text-xs text-green-700 break-all">${safeUrl}</code>`;
                // æœŸå¾…ã•ã‚Œã‚‹çµæœ
                row.insertCell().innerHTML = `<span class="text-sm text-gray-600">${item.expected}</span>`;
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
                row.insertCell().innerHTML = `<span class="${statusClass} text-xs">${statusText}</span>`;
            });

            // --- è‡ªç”±å…¥åŠ›å‡¦ç†ã®ãƒ­ã‚¸ãƒƒã‚¯ ---
            const processManualUrl = () => {
                const inputUrl = manualUrlInput.value.trim();
                if (!inputUrl) {
                    manualResultStatus.textContent = 'ã‚¨ãƒ©ãƒ¼: URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                    manualResultCode.textContent = '';
                    manualImageTestArea.innerHTML = '';
                    return;
                }

                try {
                    const safeUrl = window.corsKiller(inputUrl);

                    manualResultCode.textContent = safeUrl;

                    const isProxied = safeUrl.includes('proxy') || safeUrl.includes('allorigins') || safeUrl.includes('codetabs');

                    manualResultStatus.className = 'font-semibold mt-2 text-sm';
                    if (isProxied) {
                        manualResultStatus.textContent = 'âœ… ãƒ—ãƒ­ã‚­ã‚·å¤‰æ›ã•ã‚Œã¾ã—ãŸ';
                        manualResultStatus.classList.add('text-red-600');
                    } else {
                        manualResultStatus.textContent = 'âœ… ç´ é€šã‚Šã—ã¾ã—ãŸ';
                        manualResultStatus.classList.add('text-green-600');
                    }

                    manualImageTestArea.innerHTML = `
                        <p class="font-bold text-gray-800 mb-2">ç”»åƒãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ:</p>
                        <div class="border border-gray-300 p-2 max-w-xs h-32 flex items-center justify-center bg-gray-50 overflow-hidden">
                            <img src="${safeUrl}" alt="ãƒ†ã‚¹ãƒˆç”»åƒ" class="max-w-full max-h-full object-contain" 
                                onerror="this.parentNode.innerHTML='<span class=\\'text-red-500 text-sm\\'>ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</span>'">
                        </div>
                    `;

                } catch (error) {
                    manualResultStatus.textContent = `âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`;
                    manualResultCode.textContent = '';
                    manualImageTestArea.innerHTML = '';
                }
            };

            manualProcessButton.addEventListener('click', processManualUrl);
        });
    </script>
</head>

<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto bg-white shadow-xl rounded-xl p-8">
        <h1 class="text-4xl font-extrabold text-blue-700 mb-2">
            @onjmin/cors-killer Demo ğŸ› ï¸
        </h1>
        <p class="text-gray-600 text-lg mb-6 border-b pb-4">
            CORSåˆ¶é™ã‚’å›é¿ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« corsKiller ã®å‹•ä½œæ¤œè¨¼ãƒšãƒ¼ã‚¸ã§ã™ã€‚URLãŒãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã«å¤‰æ›ã•ã‚Œã‚‹ã‹ã€ç´ é€šã‚Šã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚
        </p>

        <div class="mb-10">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ (å®šç¾©æ¸ˆã¿)</h2>
            <div class="overflow-x-auto shadow-md rounded-lg border">
                <table class="min-w-full divide-y divide-gray-200 bg-white">
                    <thead class="bg-gray-50">
                        <tr>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/4">
                                å…ƒURL
                            </th>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/2">
                                corsKilleré©ç”¨å¾Œã®URL
                            </th>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/8">
                                æœŸå¾…ã•ã‚Œã‚‹çµæœ
                            </th>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/8">
                                å‹•ä½œæ¤œè¨¼
                            </th>
                        </tr>
                    </thead>
                    <tbody id="url-test-tbody" class="divide-y divide-gray-200">
                    </tbody>
                </table>
            </div>
        </div>

        <div>
            <h2 class="text-2xl font-bold text-gray-700 mb-4 border-t pt-6">è‡ªç”±å…¥åŠ›ãƒ†ã‚¹ãƒˆ</h2>

            <div class="flex flex-col md:flex-row gap-4 mb-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                <input id="manual-url-input" type="text" placeholder="ãƒ†ã‚¹ãƒˆã—ãŸã„ä»»æ„ã®URLã‚’å…¥åŠ›..."
                    class="flex-1 border border-gray-300 p-3 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-800"
                    value="https://picsum.photos/200/300" />
                <button id="manual-process-btn" class="
                        bg-blue-600 
                        hover:bg-blue-700 
                        text-white 
                        font-bold 
                        py-3 
                        px-6 
                        rounded-lg 
                        shadow-md 
                        hover:shadow-lg 
                        transition-colors
                    ">
                    corsKillerã‚’å®Ÿè¡Œ
                </button>
            </div>

            <div class="space-y-4">
                <p class="font-bold text-gray-800">å¤‰æ›å¾Œã®URL:</p>
                <code id="manual-result-code"
                    class="block p-3 bg-gray-800 text-green-400 text-sm rounded-lg overflow-x-auto whitespace-pre-wrap font-mono">
                    </code>
                <p id="manual-result-status" class="font-semibold mt-2 text-sm text-gray-700">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚</p>

                <div id="manual-image-test-area" class="mt-4 p-4 bg-gray-100 rounded-lg border">
                    <p class="text-gray-500">ç”»åƒãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆã®çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</p>
                </div>
            </div>
        </div>
    </div>
</body>

</html>